{"ast":null,"code":"import _taggedTemplateLiteral from\"C:/Users/sorbo/US/us-app/frontend/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9;import React,{useState,useEffect}from'react';import styled from'styled-components';import{authService,coupleService}from'../services/authService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Container=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  min-height: 100vh;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  padding: 20px;\\n\"])));const Card=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  background: rgba(255,255,255,0.9);\\n  backdrop-filter: blur(8px);\\n  padding: 40px 32px;\\n  width: 100%;\\n  max-width: 400px;\\n  border-radius: 24px;\\n  box-shadow: 0 10px 30px rgba(0,0,0,0.12);\\n  animation: fadeIn .4s ease;\\n\"])));const Title=styled.h1(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  margin: 0 0 8px;\\n  font-size: 42px;\\n  background: linear-gradient(135deg,#ff6b8a,#4ecdc4);\\n  -webkit-background-clip: text;\\n  -webkit-text-fill-color: transparent;\\n  text-align: center;\\n  font-weight: 700;\\n\"])));const Subtitle=styled.p(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  margin: 0 0 32px;\\n  text-align: center;\\n  color: #555;\\n  font-size: 15px;\\n\"])));const Form=styled.form(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n  gap: 18px;\\n\"])));const Input=styled.input(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n  padding: 14px 16px;\\n  font-size: 15px;\\n  border: 2px solid #e3e6ec;\\n  border-radius: 14px;\\n  outline: none;\\n  transition: border-color .25s, box-shadow .25s;\\n  background: #fff;\\n  &:focus {\\n    border-color: #ff6b8a;\\n    box-shadow: 0 0 0 3px rgba(255,107,138,0.25);\\n  }\\n\"])));const Button=styled.button(_templateObject7||(_templateObject7=_taggedTemplateLiteral([\"\\n  padding: 14px 18px;\\n  border: none;\\n  border-radius: 14px;\\n  background: linear-gradient(135deg,#ff6b8a,#4ecdc4);\\n  color: #fff;\\n  font-size: 16px;\\n  font-weight: 600;\\n  cursor: pointer;\\n  transition: transform .25s, box-shadow .25s;\\n  &:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0,0,0,0.18); }\\n  &:active { transform: translateY(0); }\\n  &:disabled { opacity: .6; cursor: not-allowed; transform: none; }\\n\"])));const ErrorMsg=styled.div(_templateObject8||(_templateObject8=_taggedTemplateLiteral([\"\\n  background: rgba(220,53,69,0.12);\\n  color: #c62828;\\n  padding: 10px 14px;\\n  border-radius: 12px;\\n  font-size: 14px;\\n  text-align: center;\\n\"])));const Toggle=styled.button(_templateObject9||(_templateObject9=_taggedTemplateLiteral([\"\\n  margin-top: 22px;\\n  width: 100%;\\n  background: none;\\n  border: none;\\n  color: #ff6b8a;\\n  font-weight: 600;\\n  cursor: pointer;\\n  font-size: 14px;\\n\"])));export default function Login(_ref){let{onLogin}=_ref;const[mode,setMode]=useState('login');// 'login' | 'register'\nconst[name,setName]=useState('');const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[error,setError]=useState('');const[loading,setLoading]=useState(false);const[apiStatus,setApiStatus]=useState('checking');// 'checking' | 'online' | 'offline'\n// Vérifier le statut de l'API au chargement\nuseEffect(()=>{const checkApiStatus=async()=>{try{// Test avec un endpoint qui existe (par exemple /api/test ou juste une requête OPTIONS)\nconst response=await fetch((process.env.REACT_APP_API_URL||'http://localhost:5000')+'/api/login',{method:'OPTIONS'});setApiStatus(response.ok?'online':'offline');}catch(error){// eslint-disable-next-line no-console\nconsole.error('API Status check failed:',error);setApiStatus('offline');}};checkApiStatus();},[]);const handleSubmit=async e=>{e.preventDefault();if(loading)return;setError('');setLoading(true);try{let authData;if(mode==='login'){authData=await authService.login(email.trim(),password);}else{if(name.trim().length<2)throw new Error('Nom trop court');authData=await authService.register(name.trim(),email.trim(),password);}const{access_token,user}=authData;// Stocker temporairement le token pour les appels suivants\nlocalStorage.setItem('us_token',access_token);localStorage.setItem('us_user',JSON.stringify(user));// Vérifier si l'utilisateur est dans un couple\ntry{const coupleData=await coupleService.me();if(!coupleData.in_couple){// Rediriger vers onboarding si pas de couple\nwindow.location.href='/onboarding-couple';return;}}catch(error){// Si erreur lors de la vérification du couple, rediriger vers onboarding\nwindow.location.href='/onboarding-couple';return;}// Si tout va bien, utiliser la fonction onLogin\nif(onLogin){onLogin(access_token,user);}else{// Fallback - recharger la page\nwindow.location.href='/';}}catch(err){var _err$response,_err$response$data;// eslint-disable-next-line no-console\nconsole.error('Erreur login:',err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||err.message||'Erreur');}setLoading(false);};return/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Title,{children:\"US\"}),/*#__PURE__*/_jsx(Subtitle,{children:mode==='login'?'Connexion à notre espace ':'Créer ton compte '}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',padding:'8px',marginBottom:'10px',borderRadius:'8px',background:apiStatus==='online'?'#e8f5e8':apiStatus==='offline'?'#ffe8e8':'#fff3cd',color:apiStatus==='online'?'#28a745':apiStatus==='offline'?'#dc3545':'#856404'},children:[\"\\uD83C\\uDF10 API: \",apiStatus==='online'?'✅ En ligne':apiStatus==='offline'?'❌ Hors ligne':'⏳ Vérification...']}),error&&/*#__PURE__*/_jsx(ErrorMsg,{children:error}),/*#__PURE__*/_jsxs(Form,{onSubmit:handleSubmit,children:[mode==='register'&&/*#__PURE__*/_jsx(Input,{type:\"text\",value:name,onChange:e=>setName(e.target.value),placeholder:\"Pr\\xE9nom\",required:true}),/*#__PURE__*/_jsx(Input,{type:\"email\",value:email,onChange:e=>setEmail(e.target.value),placeholder:\"Email\",required:true}),/*#__PURE__*/_jsx(Input,{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),placeholder:\"Mot de passe\",required:true}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:loading,children:loading?mode==='login'?'Connexion…':'Création…':mode==='login'?'Se connecter':'Créer le compte'})]}),/*#__PURE__*/_jsx(Toggle,{type:\"button\",onClick:()=>{setMode(mode==='login'?'register':'login');setError('');},children:mode==='login'?\"Pas de compte ? S'inscrire\":'Déjà un compte ? Se connecter'})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}