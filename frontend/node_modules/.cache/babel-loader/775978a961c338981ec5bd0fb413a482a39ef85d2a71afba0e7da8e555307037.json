{"ast":null,"code":"import _taggedTemplateLiteral from\"C:/Users/sorbo/US/us-app/frontend/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2;import React,{useState,useEffect}from'react';import styled from'styled-components';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const DiagnosticContainer=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  position: fixed;\\n  top: 0;\\n  left: 0;\\n  right: 0;\\n  background: rgba(0, 0, 0, 0.8);\\n  color: white;\\n  padding: 10px;\\n  font-size: 12px;\\n  z-index: 9999;\\n  max-height: 200px;\\n  overflow-y: auto;\\n\"])));const ToggleButton=styled.button(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  position: fixed;\\n  bottom: 20px;\\n  right: 20px;\\n  background: #ff6b8a;\\n  color: white;\\n  border: none;\\n  border-radius: 50%;\\n  width: 50px;\\n  height: 50px;\\n  font-size: 18px;\\n  cursor: pointer;\\n  z-index: 10000;\\n\"])));function PWADiagnostic(){// Auto-ouverture si pas de token ou si ?diag=1 dans l'URL\nconst shouldAutoOpen=!localStorage.getItem('us_token')||window.location.search.includes('diag=1');const[showDiagnostic,setShowDiagnostic]=useState(shouldAutoOpen);const[diagnosticInfo,setDiagnosticInfo]=useState([]);const[version]=useState(()=>{// Version simple basée sur date build chargee\nreturn'v'+new Date().toISOString().replace(/[-:T]/g,'').slice(0,12);});useEffect(()=>{const info=[];// Informations de base\ninfo.push(\"\\uD83D\\uDCF1 User Agent: \".concat(navigator.userAgent.substring(0,100),\"...\"));info.push(\"\\uD83C\\uDF10 URL: \".concat(window.location.href));info.push(\"\\uD83D\\uDCE6 Local Storage Items: \".concat(localStorage.length));// Vérifier le token\nconst token=localStorage.getItem('us_token');const userData=localStorage.getItem('us_user');info.push(\"\\uD83D\\uDD11 Token pr\\xE9sent: \".concat(!!token));info.push(\"\\uD83D\\uDC64 User data pr\\xE9sent: \".concat(!!userData));if(token){try{const payload=JSON.parse(atob(token.split('.')[1]));const isValid=payload.exp*1000>Date.now();info.push(\"\\u2705 Token valide: \".concat(isValid));info.push(\"\\u23F0 Token expire: \".concat(new Date(payload.exp*1000).toLocaleString()));}catch(error){info.push(\"\\u274C Erreur token: \".concat(error.message));}}// Service Worker\nif('serviceWorker'in navigator){navigator.serviceWorker.getRegistrations().then(registrations=>{info.push(\"\\uD83D\\uDD27 Service Workers: \".concat(registrations.length));registrations.forEach((registration,index)=>{var _registration$active;info.push(\"SW\".concat(index,\": \").concat(((_registration$active=registration.active)===null||_registration$active===void 0?void 0:_registration$active.state)||'N/A'));});setDiagnosticInfo([...info]);});}else{info.push(\"\\u274C Service Worker non support\\xE9\");}// PWA\ninfo.push(\"\\uD83D\\uDCF2 PWA mode: \".concat(window.matchMedia('(display-mode: standalone)').matches?'Standalone':'Browser'));// Network\ninfo.push(\"\\uD83D\\uDCF6 Online: \".concat(navigator.onLine));// Ajouter info sur dimensions viewport\ninfo.push(\"\\uD83D\\uDCD0 Viewport: \".concat(window.innerWidth,\"x\").concat(window.innerHeight));info.push(\"\\uD83D\\uDD52 Charg\\xE9 \\xE0: \".concat(new Date().toLocaleTimeString()));info.push(\"\\uD83C\\uDFF7\\uFE0F Version: \".concat(version));setDiagnosticInfo(info);},[]);const clearStorage=()=>{localStorage.clear();sessionStorage.clear();window.location.reload();};const reinstallSW=async()=>{if('serviceWorker'in navigator){const registrations=await navigator.serviceWorker.getRegistrations();for(let registration of registrations){await registration.unregister();}window.location.reload();}};if(!showDiagnostic){return/*#__PURE__*/_jsx(ToggleButton,{onClick:()=>setShowDiagnostic(true),children:\"\\uD83D\\uDD0D\"});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(DiagnosticContainer,{children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'10px'},children:[/*#__PURE__*/_jsxs(\"strong\",{children:[\"\\uD83D\\uDD0D PWA Diagnostic (\",version,\")\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowDiagnostic(false),style:{background:'none',border:'none',color:'white',cursor:'pointer'},children:\"\\u274C\"})]}),diagnosticInfo.map((info,index)=>/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'5px'},children:info},index)),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'10px',display:'flex',gap:'10px'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:clearStorage,style:{background:'#ff6b8a',color:'white',border:'none',padding:'5px 10px',borderRadius:'5px',fontSize:'10px'},children:\"\\uD83D\\uDDD1\\uFE0F Clear Storage\"}),/*#__PURE__*/_jsx(\"button\",{onClick:reinstallSW,style:{background:'#4ecdc4',color:'white',border:'none',padding:'5px 10px',borderRadius:'5px',fontSize:'10px'},children:\"\\uD83D\\uDD04 Reinstall SW\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.reload(),style:{background:'#333',color:'white',border:'none',padding:'5px 10px',borderRadius:'5px',fontSize:'10px'},children:\"\\uD83D\\uDD04 Reload\"})]})]}),/*#__PURE__*/_jsx(ToggleButton,{onClick:()=>setShowDiagnostic(false),children:\"\\u274C\"})]});}export default PWADiagnostic;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}