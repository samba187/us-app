{"ast":null,"code":"import _objectSpread from\"C:/Users/sorbo/US/us-app/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _taggedTemplateLiteral from\"C:/Users/sorbo/US/us-app/frontend/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject0,_templateObject1,_templateObject10,_templateObject11,_templateObject12,_templateObject13,_templateObject14,_templateObject15,_templateObject16,_templateObject17,_templateObject18,_templateObject19,_templateObject20,_templateObject21,_templateObject22,_templateObject23,_templateObject24,_templateObject25;import React,{useState,useEffect}from'react';import styled from'styled-components';import{FiPlus,FiCheck,FiClock,FiAlertCircle}from'react-icons/fi';import{reminderService}from'../services/authService';import notificationService from'../services/notificationService';import crossNotificationService from'../services/crossNotificationService';import NotificationSettings from'../components/NotificationSettings';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const RemindersContainer=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  padding: 20px;\\n  padding-bottom: 120px;\\n\"])));const Header=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: between;\\n  align-items: center;\\n  margin-bottom: 30px;\\n\"])));const Title=styled.h1(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  font-size: 28px;\\n  font-weight: 700;\\n  color: var(--text-color);\\n\"])));const AddButton=styled.button(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  background: linear-gradient(135deg, #ff6b8a, #4ecdc4);\\n  color: white;\\n  border: none;\\n  padding: 12px 20px;\\n  border-radius: 12px;\\n  font-weight: 600;\\n  cursor: pointer;\\n  display: flex;\\n  align-items: center;\\n  gap: 8px;\\n\"])));const FilterTabs=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  display: flex;\\n  background: white;\\n  border-radius: 12px;\\n  padding: 4px;\\n  margin-bottom: 20px;\\n  box-shadow: var(--shadow);\\n\"])));const FilterTab=styled.button(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  padding: 12px;\\n  border: none;\\n  border-radius: 8px;\\n  background: \",\";\\n  color: \",\";\\n  font-weight: 600;\\n  cursor: pointer;\\n  transition: all 0.3s ease;\\n\"])),props=>props.active?'var(--primary-color)':'transparent',props=>props.active?'white':'var(--text-color)');const ReminderCard=styled.div(_templateObject7||(_templateObject7=_taggedTemplateLiteral([\"\\n  background: white;\\n  padding: 20px;\\n  border-radius: 16px;\\n  box-shadow: var(--shadow);\\n  margin-bottom: 15px;\\n  border-left: 4px solid \",\";\\n\"])),props=>{switch(props.priority){case'urgent':return'#ff4757';case'important':return'#ffa502';default:return'#2ed573';}});const ReminderHeader=styled.div(_templateObject8||(_templateObject8=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: flex-start;\\n  margin-bottom: 10px;\\n\"])));const ReminderTitle=styled.h3(_templateObject9||(_templateObject9=_taggedTemplateLiteral([\"\\n  font-size: 18px;\\n  font-weight: 600;\\n  color: var(--text-color);\\n  flex: 1;\\n\"])));const CompleteButton=styled.button(_templateObject0||(_templateObject0=_taggedTemplateLiteral([\"\\n  background: \",\";\\n  color: \",\";\\n  border: none;\\n  width: 30px;\\n  height: 30px;\\n  border-radius: 50%;\\n  cursor: pointer;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n\"])),props=>props.completed?'#2ed573':'var(--border-color)',props=>props.completed?'white':'var(--text-color)');const ReminderDescription=styled.p(_templateObject1||(_templateObject1=_taggedTemplateLiteral([\"\\n  color: var(--text-light);\\n  margin-bottom: 15px;\\n  line-height: 1.4;\\n\"])));const ReminderMeta=styled.div(_templateObject10||(_templateObject10=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  gap: 15px;\\n  font-size: 14px;\\n  color: var(--text-light);\\n\"])));const PriorityBadge=styled.span(_templateObject11||(_templateObject11=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  gap: 5px;\\n  padding: 4px 8px;\\n  border-radius: 6px;\\n  font-size: 12px;\\n  font-weight: 600;\\n  text-transform: uppercase;\\n  background: \",\";\\n  color: \",\";\\n\"])),props=>{switch(props.priority){case'urgent':return'rgba(255, 71, 87, 0.1)';case'important':return'rgba(255, 165, 2, 0.1)';default:return'rgba(46, 213, 115, 0.1)';}},props=>{switch(props.priority){case'urgent':return'#ff4757';case'important':return'#ffa502';default:return'#2ed573';}});const Modal=styled.div(_templateObject12||(_templateObject12=_taggedTemplateLiteral([\"\\n  position: fixed;\\n  top: 0;\\n  left: 0;\\n  right: 0;\\n  bottom: 0;\\n  background: rgba(0, 0, 0, 0.5);\\n  display: \",\";\\n  align-items: center;\\n  justify-content: center;\\n  z-index: 2000;\\n  padding: 20px;\\n\"])),props=>props.show?'flex':'none');const ModalContent=styled.div(_templateObject13||(_templateObject13=_taggedTemplateLiteral([\"\\n  background: white;\\n  border-radius: 20px;\\n  padding: 30px;\\n  width: 100%;\\n  max-width: 400px;\\n  max-height: 80vh;\\n  overflow-y: auto;\\n\"])));const ModalTitle=styled.h2(_templateObject14||(_templateObject14=_taggedTemplateLiteral([\"\\n  margin-bottom: 20px;\\n  color: var(--text-color);\\n\"])));const Form=styled.form(_templateObject15||(_templateObject15=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n  gap: 15px;\\n\"])));const Input=styled.input(_templateObject16||(_templateObject16=_taggedTemplateLiteral([\"\\n  padding: 12px;\\n  border: 2px solid var(--border-color);\\n  border-radius: 8px;\\n  font-size: 16px;\\n\\n  &:focus {\\n    outline: none;\\n    border-color: var(--primary-color);\\n  }\\n\"])));const TextArea=styled.textarea(_templateObject17||(_templateObject17=_taggedTemplateLiteral([\"\\n  padding: 12px;\\n  border: 2px solid var(--border-color);\\n  border-radius: 8px;\\n  font-size: 16px;\\n  min-height: 80px;\\n  resize: vertical;\\n  font-family: inherit;\\n\\n  &:focus {\\n    outline: none;\\n    border-color: var(--primary-color);\\n  }\\n\"])));const Select=styled.select(_templateObject18||(_templateObject18=_taggedTemplateLiteral([\"\\n  padding: 12px;\\n  border: 2px solid var(--border-color);\\n  border-radius: 8px;\\n  font-size: 16px;\\n  background: white;\\n\\n  &:focus {\\n    outline: none;\\n    border-color: var(--primary-color);\\n  }\\n\"])));const FormButtons=styled.div(_templateObject19||(_templateObject19=_taggedTemplateLiteral([\"\\n  display: flex;\\n  gap: 10px;\\n  margin-top: 20px;\\n\"])));const Button=styled.button(_templateObject20||(_templateObject20=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  padding: 12px;\\n  border-radius: 8px;\\n  font-weight: 600;\\n  cursor: pointer;\\n  border: none;\\n\"])));const PrimaryButton=styled(Button)(_templateObject21||(_templateObject21=_taggedTemplateLiteral([\"\\n  background: linear-gradient(135deg, #ff6b8a, #4ecdc4);\\n  color: white;\\n\"])));const SecondaryButton=styled(Button)(_templateObject22||(_templateObject22=_taggedTemplateLiteral([\"\\n  background: var(--border-color);\\n  color: var(--text-color);\\n\"])));const EditDeleteRow=styled.div(_templateObject23||(_templateObject23=_taggedTemplateLiteral([\"\\n  display: flex;\\n  gap: 8px;\\n  margin-top: 10px;\\n  padding-top: 10px;\\n  border-top: 1px solid var(--border-color);\\n\"])));const EditButton=styled.button(_templateObject24||(_templateObject24=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  padding: 8px 12px;\\n  background: #4ecdc4;\\n  color: white;\\n  border: none;\\n  border-radius: 6px;\\n  font-size: 12px;\\n  font-weight: 600;\\n  cursor: pointer;\\n\"])));const DeleteButton=styled.button(_templateObject25||(_templateObject25=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  padding: 8px 12px;\\n  background: #ff6b8a;\\n  color: white;\\n  border: none;\\n  border-radius: 6px;\\n  font-size: 12px;\\n  font-weight: 600;\\n  cursor: pointer;\\n\"])));function Reminders(){const[reminders,setReminders]=useState([]);const[filteredReminders,setFilteredReminders]=useState([]);const[filter,setFilter]=useState('all');const[showModal,setShowModal]=useState(false);const[loading,setLoading]=useState(true);const[editingReminder,setEditingReminder]=useState(null);const[formData,setFormData]=useState({title:'',description:'',priority:'normal',due_date:''});useEffect(()=>{loadReminders();// Initialiser les notifications\ninitNotifications();},[]);const initNotifications=async()=>{try{await notificationService.init();}catch(error){console.error('Erreur initialisation notifications:',error);}};useEffect(()=>{const filterReminders=()=>{let filtered=reminders;switch(filter){case'pending':filtered=reminders.filter(r=>r.status==='pending');break;case'urgent':filtered=reminders.filter(r=>r.priority==='urgent'&&r.status==='pending');break;case'completed':filtered=reminders.filter(r=>r.status==='done');break;default:break;}setFilteredReminders(filtered);};filterReminders();// Programmer les notifications pour les échéances\nconst notificationSettings=JSON.parse(localStorage.getItem('notification_settings')||'{}');if(notificationSettings.dueDateReminders!==false){notificationService.scheduleReminderNotifications(reminders);}},[reminders,filter]);const loadReminders=async()=>{try{const data=await reminderService.getAll();setReminders(data);}catch(error){console.error('Erreur lors du chargement des rappels:',error);}setLoading(false);};const handleSubmit=async e=>{e.preventDefault();try{let reminder;if(editingReminder){await reminderService.update(editingReminder._id,formData);reminder=_objectSpread(_objectSpread({},editingReminder),formData);}else{const result=await reminderService.create(formData);reminder=result;// Notification locale pour l'utilisateur actuel\nconst notificationSettings=JSON.parse(localStorage.getItem('notification_settings')||'{}');if(notificationSettings.newReminders!==false){await notificationService.notifyNewReminder(reminder);// Notification spéciale pour rappels urgents\nif(reminder.priority==='urgent'&&notificationSettings.urgentReminders!==false){setTimeout(()=>{notificationService.notifyUrgentReminder(reminder);},1000);}}// 🔔 NOTIFICATION CROISÉE pour le/la partenaire\nsetTimeout(()=>{crossNotificationService.triggerImmediateCheck();},1000);}setShowModal(false);setEditingReminder(null);setFormData({title:'',description:'',priority:'normal',due_date:''});loadReminders();}catch(error){console.error('Erreur lors de la sauvegarde du rappel:',error);}};const toggleComplete=async(id,currentStatus)=>{try{const newStatus=currentStatus==='pending'?'done':'pending';await reminderService.update(id,{status:newStatus});loadReminders();}catch(error){console.error('Erreur lors de la mise à jour du rappel:',error);}};const handleEdit=reminder=>{setEditingReminder(reminder);setFormData({title:reminder.title,description:reminder.description||'',priority:reminder.priority,due_date:reminder.due_date?reminder.due_date.split('T')[0]:''});setShowModal(true);};const handleDelete=async id=>{if(window.confirm('Supprimer ce rappel ?')){try{await reminderService.delete(id);loadReminders();}catch(error){console.error('Erreur suppression:',error);}}};const getPriorityIcon=priority=>{switch(priority){case'urgent':return/*#__PURE__*/_jsx(FiAlertCircle,{});case'important':return/*#__PURE__*/_jsx(FiClock,{});default:return/*#__PURE__*/_jsx(FiCheck,{});}};if(loading){return/*#__PURE__*/_jsx(RemindersContainer,{children:/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',marginTop:'50px'},children:\"Chargement des rappels...\"})});}return/*#__PURE__*/_jsxs(RemindersContainer,{className:\"fade-in\",children:[/*#__PURE__*/_jsxs(Header,{children:[/*#__PURE__*/_jsx(Title,{children:\"Rappels\"}),/*#__PURE__*/_jsxs(AddButton,{onClick:()=>setShowModal(true),children:[/*#__PURE__*/_jsx(FiPlus,{}),\" Ajouter\"]})]}),/*#__PURE__*/_jsx(NotificationSettings,{}),/*#__PURE__*/_jsxs(FilterTabs,{children:[/*#__PURE__*/_jsx(FilterTab,{active:filter==='all',onClick:()=>setFilter('all'),children:\"Tous\"}),/*#__PURE__*/_jsx(FilterTab,{active:filter==='pending',onClick:()=>setFilter('pending'),children:\"En cours\"}),/*#__PURE__*/_jsx(FilterTab,{active:filter==='urgent',onClick:()=>setFilter('urgent'),children:\"Urgents\"}),/*#__PURE__*/_jsx(FilterTab,{active:filter==='completed',onClick:()=>setFilter('completed'),children:\"Termin\\xE9s\"})]}),filteredReminders.map(reminder=>/*#__PURE__*/_jsxs(ReminderCard,{priority:reminder.priority,children:[/*#__PURE__*/_jsxs(ReminderHeader,{children:[/*#__PURE__*/_jsx(ReminderTitle,{children:reminder.title}),/*#__PURE__*/_jsx(CompleteButton,{completed:reminder.status==='done',onClick:()=>toggleComplete(reminder._id,reminder.status),children:/*#__PURE__*/_jsx(FiCheck,{})})]}),reminder.description&&/*#__PURE__*/_jsx(ReminderDescription,{children:reminder.description}),/*#__PURE__*/_jsxs(ReminderMeta,{children:[/*#__PURE__*/_jsxs(PriorityBadge,{priority:reminder.priority,children:[getPriorityIcon(reminder.priority),reminder.priority]}),reminder.due_date&&/*#__PURE__*/_jsxs(\"span\",{children:[\"\\uD83D\\uDCC5 \",new Date(reminder.due_date).toLocaleDateString('fr-FR')]})]}),/*#__PURE__*/_jsxs(EditDeleteRow,{children:[/*#__PURE__*/_jsx(EditButton,{onClick:()=>handleEdit(reminder),children:\"Modifier\"}),/*#__PURE__*/_jsx(DeleteButton,{onClick:()=>handleDelete(reminder._id),children:\"Supprimer\"})]})]},reminder._id)),filteredReminders.length===0&&/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',padding:'40px',color:'var(--text-light)'},children:filter==='all'?'Aucun rappel pour le moment':\"Aucun rappel \".concat(filter==='pending'?'en cours':filter==='urgent'?'urgent':'terminé')}),/*#__PURE__*/_jsx(Modal,{show:showModal,onClick:()=>setShowModal(false),children:/*#__PURE__*/_jsxs(ModalContent,{onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(ModalTitle,{children:\"Nouveau rappel\"}),/*#__PURE__*/_jsxs(Form,{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(Input,{type:\"text\",placeholder:\"Titre du rappel\",value:formData.title,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{title:e.target.value})),required:true}),/*#__PURE__*/_jsx(TextArea,{placeholder:\"Description (optionnel)\",value:formData.description,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{description:e.target.value}))}),/*#__PURE__*/_jsxs(Select,{value:formData.priority,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{priority:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"normal\",children:\"Normal\"}),/*#__PURE__*/_jsx(\"option\",{value:\"important\",children:\"Important\"}),/*#__PURE__*/_jsx(\"option\",{value:\"urgent\",children:\"Urgent\"})]}),/*#__PURE__*/_jsx(Input,{type:\"datetime-local\",value:formData.due_date,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{due_date:e.target.value}))}),/*#__PURE__*/_jsxs(FormButtons,{children:[/*#__PURE__*/_jsx(SecondaryButton,{type:\"button\",onClick:()=>setShowModal(false),children:\"Annuler\"}),/*#__PURE__*/_jsx(PrimaryButton,{type:\"submit\",children:\"Cr\\xE9er\"})]})]})]})})]});}export default Reminders;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}