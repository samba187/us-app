{"ast":null,"code":"import React,{useEffect,useState}from'react';import{coupleService,reminderService}from'../services/authService';// Mini styles (inline / simple) to avoid heavy duplication from Reminders page\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const sectionStyle={margin:'24px 0',padding:16,border:'1px solid #eee',borderRadius:12,background:'#fff'};const reminderItemStyle=priority=>({padding:'10px 12px',borderRadius:12,background:'#fff',boxShadow:'0 2px 6px rgba(0,0,0,0.06)',display:'flex',flexDirection:'column',gap:4,borderLeft:\"4px solid \".concat(priority==='urgent'?'#ff4757':priority==='important'?'#ffa502':'#2ed573')});const badgeStyle=priority=>({fontSize:11,fontWeight:600,alignSelf:'flex-start',padding:'2px 8px',borderRadius:20,background:priority==='urgent'?'rgba(255,71,87,.12)':priority==='important'?'rgba(255,165,2,.15)':'rgba(46,213,115,.15)',color:priority==='urgent'?'#ff4757':priority==='important'?'#c07900':'#038a46'});export default function Home(){const[loading,setLoading]=useState(true);const[inCouple,setInCouple]=useState(false);const[inviteCode,setInviteCode]=useState(null);const[partner,setPartner]=useState(null);const[reminders,setReminders]=useState([]);// preview\nconst[remindersLoading,setRemindersLoading]=useState(false);useEffect(()=>{(async()=>{try{const cm=await coupleService.me();setInCouple(!!cm.in_couple);setInviteCode(cm.invite_code||null);if(cm.members&&cm.members.length>1){const me=JSON.parse(localStorage.getItem('us_user')||'{}');setPartner(cm.members.find(m=>m.email!==(me===null||me===void 0?void 0:me.email))||null);}if(cm.in_couple){// Charger un aperçu de 3 rappels (priorité urgente ou en cours) triés par due date puis priorité\nsetRemindersLoading(true);try{const data=await reminderService.getAll();const sorted=[...data].sort((a,b)=>{// Priorité: urgent > important > normal\nconst pr=p=>p==='urgent'?0:p==='important'?1:2;const dueA=a.due_date?new Date(a.due_date).getTime():Infinity;const dueB=b.due_date?new Date(b.due_date).getTime():Infinity;if(dueA!==dueB)return dueA-dueB;return pr(a.priority)-pr(b.priority);}).filter(r=>r.status!=='done').slice(0,3);setReminders(sorted);}catch(_unused){}setRemindersLoading(false);}}finally{setLoading(false);}})();},[]);const handleInvite=async()=>{try{let code=inviteCode;if(!code){const cm=await coupleService.me();code=cm.invite_code;if(!code){const res=await coupleService.create();// crée/refait le code si besoin\ncode=res.invite_code;}}setInviteCode(code);const shareUrl=\"\".concat(window.location.origin,\"/onboarding-couple?code=\").concat(code);alert(\"Code d\\u2019invitation : \".concat(code,\"\\n\\nLien \\xE0 envoyer :\\n\").concat(shareUrl));if(navigator.share){try{await navigator.share({title:'Notre app',text:\"Code : \".concat(code),url:shareUrl});}catch(_unused2){}}}catch(_unused3){alert('Impossible de générer le code. Réessaie.');}};if(loading)return/*#__PURE__*/_jsx(\"div\",{children:\"Chargement\\u2026\"});return/*#__PURE__*/_jsxs(\"div\",{children:[!inCouple?/*#__PURE__*/_jsxs(\"div\",{style:{margin:'16px 0',padding:16,border:'1px solid #eee',borderRadius:12},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:700,marginBottom:8},children:\"En attente\\u2026 \\uD83D\\uDC95\"}),/*#__PURE__*/_jsx(\"div\",{children:\"Invite ta copine \\xE0 rejoindre l\\u2019app !\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleInvite,style:{marginTop:12},children:\"G\\xE9n\\xE9rer / afficher le code\"}),inviteCode&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:8,fontFamily:'monospace'},children:[\"Code : \",/*#__PURE__*/_jsx(\"strong\",{children:inviteCode})]})]}):/*#__PURE__*/_jsx(\"div\",{style:{margin:'16px 0',padding:16,border:'1px solid #eee',borderRadius:12},children:/*#__PURE__*/_jsxs(\"div\",{children:[\"\\uD83D\\uDC91 Vous \\xEAtes reli\\xE9s \",partner?\"avec \".concat(partner.name):'',\" \\u2014 profitez de l\\u2019app !\"]})}),inCouple&&/*#__PURE__*/_jsxs(\"div\",{style:sectionStyle,children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12},children:[/*#__PURE__*/_jsx(\"h2\",{style:{margin:0,fontSize:20},children:\"Rappels rapides\"}),/*#__PURE__*/_jsx(\"a\",{href:\"/reminders\",style:{fontSize:13,fontWeight:600,color:'#ff6b8a'},children:\"Tous \\u279C\"})]}),remindersLoading&&/*#__PURE__*/_jsx(\"div\",{style:{fontSize:14,color:'#666'},children:\"Chargement\\u2026\"}),!remindersLoading&&reminders.length===0&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:14,color:'#777'},children:[\"Aucun rappel en cours. \",/*#__PURE__*/_jsx(\"a\",{href:\"/reminders\",style:{color:'#ff6b8a'},children:\"Cr\\xE9er un rappel\"}),\".\"]}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexDirection:'column',gap:10},children:reminders.map(r=>/*#__PURE__*/_jsxs(\"div\",{style:reminderItemStyle(r.priority),children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'flex-start'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600,fontSize:15},children:r.title}),/*#__PURE__*/_jsx(\"span\",{style:badgeStyle(r.priority),children:r.priority})]}),r.description&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:13,color:'#555'},children:[r.description.slice(0,120),r.description.length>120?'…':'']}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:11,color:'#666',display:'flex',gap:12},children:[r.due_date&&/*#__PURE__*/_jsxs(\"span\",{children:[\"\\uD83D\\uDCC5 \",new Date(r.due_date).toLocaleDateString('fr-FR')]}),r.status==='pending'&&/*#__PURE__*/_jsx(\"span\",{children:\"\\u23F3 en cours\"})]})]},r._id))})]})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}